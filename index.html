<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GRAINOS | API & 合意リンク作成</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0f121a;color:#eaf0ff}
  .wrap{max-width:780px;margin:40px auto;padding:0 16px}
  h1{margin:0 0 12px;font-size:24px}
  .card{background:#161b22;border:1px solid #22293a;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);margin-top:18px}
  .hd{padding:16px 18px;border-bottom:1px solid #21283a}
  .bd{padding:18px;display:grid;gap:14px}
  label{display:block;font-size:12px;color:#9aa4b2;margin:6px 0}
  input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a344a;background:#0f141c;color:#eaf0ff;outline:none}
  input:focus{border-color:#3a4b7a;box-shadow:0 0 0 3px #3a4b7a40}
  .row{display:grid;grid-template-columns:1fr 220px;gap:12px}
  .btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
  .gen{background:#7aa2ff;color:#0a1020}
  .copy{background:#25314b;color:#eaf0ff}
  .open{background:#3ecf8e;color:#062d1d;text-decoration:none;display:inline-block}
  .actions{display:flex;gap:10px;flex-wrap:wrap}
  .out{background:#0f141c;border:1px dashed #2b3450;border-radius:10px;padding:10px 12px;word-break:break-all}
  ul{line-height:1.8;margin:0 0 6px 1.1em}
  a{color:#7aa2ff}
  .muted{color:#9aa4b2;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <h1>GRAINOS API</h1>
  <ul>
    <li><a href="/api/summary?text=テスト">/api/summary?text=テスト</a></li>
    <li><a href="/api/confirm-ui">/api/confirm-ui</a></li>
  </ul>

  <div class="card">
    <div class="hd">合意UIリンク作成</div>
    <div class="bd">
      <div><label>主語</label><input id="subject" placeholder="例）私 / 企画チーム"></div>
      <div class="row">
        <div><label>要旨</label><input id="gist" placeholder="例）ドラフトを承認"></div>
        <div><label>期限</label><input id="deadline" type="date"></div>
      </div>
      <div class="actions">
        <button class="btn gen"  id="make">リンクを生成</button>
        <button class="btn copy" id="copy" disabled>コピー</button>
        <a class="btn open" id="open" href="#" target="_blank" rel="noopener" style="pointer-events:none;opacity:.6">開く</a>
      </div>
      <div>
        <label>生成されたURL</label>
        <div id="url" class="out">（ここにURLが表示されます）</div>
        <div class="muted">このURLをChatworkなどに貼ると、合意確認UIが開きます。</div>
      </div>
    </div>
  </div>
</div>

<script>
  const el = id => document.getElementById(id);
  const subject=el('subject'), gist=el('gist'), deadline=el('deadline');
  const out=el('url'), copy=el('copy'), openBtn=el('open');

  // 期限の初期値：今日+7日
  (()=>{
    const d=new Date(); d.setDate(d.getDate()+7);
    deadline.value=d.toISOString().slice(0,10);
  })();

  const build=()=>{
    const base = location.origin + '/api/confirm-ui';
    const q=new URLSearchParams();
    if(subject.value.trim())  q.set('subject', subject.value.trim());
    if(gist.value.trim())     q.set('gist',    gist.value.trim());
    if(deadline.value.trim()) q.set('deadline',deadline.value.trim());
    return base + (q.toString()?('?'+q.toString()):'');
  };

  el('make').onclick=(e)=>{
    e.preventDefault();
    const url=build();
    out.textContent=url;
    copy.disabled=!url;
    openBtn.href=url;
    openBtn.style.pointerEvents=url?'auto':'none';
    openBtn.style.opacity=url?'1':'.6';
  };

  copy.onclick=async ()=>{
    const url=out.textContent.trim(); if(!url) return;
    await navigator.clipboard.writeText(url);
    copy.textContent='コピーしました'; setTimeout(()=>copy.textContent='コピー',1200);
  };
</script>
</body>
</html>
